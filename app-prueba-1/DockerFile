# Usamos la imagen base de ASP.NET Core
FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS base
WORKDIR /app
EXPOSE 10000

# Usamos la imagen del SDK para compilar
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src

# --- AQUÍ ESTÁ EL CAMBIO CLAVE ---
# Como el Dockerfile está dentro de la carpeta, pero el contexto es la raíz,
# debemos especificar la ruta "app-prueba-1/" para encontrar el .csproj
COPY ["app-prueba-1/app-prueba-1.csproj", "app-prueba-1/"]

# Restauramos las dependencias
RUN dotnet restore "app-prueba-1/app-prueba-1.csproj"

# Copiamos todo lo demás
COPY . .

# --- CAMBIO IMPORTANTE ---
# Ahora entramos en la carpeta del proyecto para compilarlo
WORKDIR "/src/app-prueba-1"

# Compilamos y publicamos
RUN dotnet build "app-prueba-1.csproj" -c Release -o /app/build

FROM build AS publish
RUN dotnet publish "app-prueba-1.csproj" -c Release -o /app/publish

# Imagen final
FROM base AS final
WORKDIR /app
COPY --from=publish /app/publish .
ENTRYPOINT ["dotnet", "app-prueba-1.dll"]